(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[473],{2304:function(e,r,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth",function(){return s(3044)}])},9703:function(e,r,s){"use strict";s.d(r,{j:function(){return l}});var o=s(5944),n=s(38),a=s(1163),i=s(7294);let l=e=>{let{routeToPushIfNoAuth:r,routeToPushIfAuth:s}=e,l=(0,a.useRouter)(),{user:t,setUser:d}=(0,i.useContext)(o.V),[c,u]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{(async()=>{let e=await n.Z.validateRefreshToken();d(e||null),u(!1)})()},[]),(0,i.useEffect)(()=>{t||c||!r||l.push(r),t&&!c&&s&&l.push(s)},[t,c]),{user:t,isLoading:c}}},3044:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return O}});var o=s(5893),n=s(7294),a=s(8862),i=s(9543),l=s(5667),t=s(7357),d=s(5582),c=s(5861),u=s(9008),m=s.n(u),x=s(5816),p=s(629),h=s(1703),g=s(44),j=s(1233),f=s(3321),v=s(7536),Z=s(6310),y=s(8659),w=e=>{let{control:r,name:s,rules:n,...a}=e;return(0,o.jsx)(v.Qr,{control:r,name:s,rules:n,render:e=>{var r;let{field:n,fieldState:i,formState:l}=e;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(y.Z,{value:n.value,onChange:n.onChange,error:!!(null===(r=l.errors[s])||void 0===r?void 0:r.type),...a})})}})},b=s(5179),C=s(38);let _=(0,n.createContext)({registrationData:{name:"",parentName:null,birth:null,email:"",phone:null,password:""},setRegistrationData:()=>{}}),A=Z.Ry({name:Z.Z_().required(),parentName:Z.Z_().required(),birth:Z.Z_().matches(/^\d\d.\d\d.\d\d\d\d$/).required(),email:Z.Z_().email().required(),phone:Z.Z_().min(11).max(12).required(),password:Z.Z_().min(8).required(),passwordAgain:Z.Z_().min(8).required()}).required(),S=e=>{var r,s,a;let{onRegistrationClick:i}=e,{setRegistrationData:l}=(0,n.useContext)(_),{control:t,handleSubmit:d,setError:u,formState:m}=(0,v.cI)({defaultValues:{name:"",parentName:"",birth:"",email:"",phone:"",password:"",passwordAgain:""},resolver:(0,x.X)(A)}),p=async e=>{if(e.password!==e.passwordAgain){u("password",{type:"value",message:"Пароли не совпадают"}),u("passwordAgain",{type:"value",message:"Пароли не совпадают"});return}let{passwordAgain:r,...s}=e;l(s);try{await C.Z.sendCode(e.email),i()}catch(e){u("root",{message:e.response.data.message})}};return(0,o.jsxs)("form",{style:{display:"flex",flexDirection:"column"},onSubmit:d(p),children:[(0,o.jsxs)(j.Z,{spacing:1.5,children:[(0,o.jsx)(w,{control:t,name:"name",label:"ФИО ребенка",fullWidth:!0}),(0,o.jsx)(w,{control:t,name:"parentName",label:"ФИО родителя",fullWidth:!0}),(0,o.jsx)(w,{control:t,name:"birth",label:"Дата рождения ребенка (ДД.ММ.ГГГГ)",fullWidth:!0}),(0,o.jsx)(w,{control:t,name:"email",label:"Почта",fullWidth:!0}),(0,o.jsx)(w,{control:t,name:"phone",label:"Номер телефона",fullWidth:!0}),(0,o.jsx)(w,{control:t,name:"password",label:"Пароль",type:"password",fullWidth:!0}),(0,o.jsx)(w,{control:t,name:"passwordAgain",label:"Повторите пароль",type:"password",fullWidth:!0}),(null===(r=m.errors.root)||void 0===r?void 0:r.message)&&(0,o.jsx)(c.Z,{color:"error",children:Array.isArray(m.errors.root.message)?null===(s=m.errors.root)||void 0===s?void 0:s.message[0]:null===(a=m.errors.root)||void 0===a?void 0:a.message})]}),(0,o.jsx)(f.Z,{type:"submit",variant:"contained",sx:{marginTop:2},children:"Зарегистрироваться"})]})},q=Z.Ry({name:Z.Z_().required(),email:Z.Z_().email().required(),password:Z.Z_().min(8).required(),passwordAgain:Z.Z_().min(8).required()}).required(),k=e=>{var r,s,a;let{onRegistrationClick:i}=e,{setRegistrationData:l}=(0,n.useContext)(_),{control:t,handleSubmit:d,setError:u,formState:m}=(0,v.cI)({defaultValues:{name:"",email:"",password:"",passwordAgain:""},resolver:(0,x.X)(q)}),p=async e=>{if(e.password!==e.passwordAgain){u("password",{type:"value",message:"Пароли не совпадают"}),u("passwordAgain",{type:"value",message:"Пароли не совпадают"});return}let{passwordAgain:r,...s}=e;l(s);try{await C.Z.sendCode(e.email),i()}catch(e){u("root",{message:e.response.data.message})}};return(0,o.jsxs)("form",{style:{display:"flex",flexDirection:"column"},onSubmit:d(p),children:[(0,o.jsxs)(j.Z,{spacing:1.5,children:[(0,o.jsx)(w,{control:t,name:"name",label:"ФИО",fullWidth:!0}),(0,o.jsx)(w,{control:t,name:"email",label:"Почта",fullWidth:!0}),(0,o.jsx)(w,{control:t,name:"password",label:"Пароль",type:"password",fullWidth:!0}),(0,o.jsx)(w,{control:t,name:"passwordAgain",label:"Повторите пароль",type:"password",fullWidth:!0}),(null===(r=m.errors.root)||void 0===r?void 0:r.message)&&(0,o.jsx)(c.Z,{color:"error",children:Array.isArray(m.errors.root.message)?null===(s=m.errors.root)||void 0===s?void 0:s.message[0]:null===(a=m.errors.root)||void 0===a?void 0:a.message})]}),(0,o.jsx)(f.Z,{type:"submit",variant:"contained",sx:{marginTop:2},children:"Зарегистрироваться"})]})};var P=e=>{let{onLoginClick:r,onRegistrationClick:s}=e,[a,i]=(0,n.useState)(0);return(0,o.jsxs)(p.Z,{sx:{padding:2.5,paddingTop:1},children:[(0,o.jsxs)(h.Z,{value:a,onChange:(e,r)=>{i(r)},sx:{marginBottom:"15px"},children:[(0,o.jsx)(g.Z,{label:"Ребенок",disableRipple:!0}),(0,o.jsx)(g.Z,{label:"Тренер",disableRipple:!0})]}),0===a?(0,o.jsx)(S,{onRegistrationClick:s}):(0,o.jsx)(k,{onRegistrationClick:s}),(0,o.jsxs)(t.Z,{sx:{display:"flex",justifyContent:"center",gap:"5px",marginTop:.5,marginBottom:-1.5},children:[(0,o.jsx)(c.Z,{fontSize:14,children:"Уже есть аккаунт?"}),(0,o.jsx)(b.Z,{fontSize:14,component:"button",underline:"none",onClick:r,children:"Войти"})]})]})},R=s(1163),W=s(5944);let z=(0,n.createContext)({passwordRecoveryData:{email:""},setPasswordRecoveryData:()=>{}}),T=Z.Ry({email:Z.Z_().email().required(),password:Z.Z_().min(8).required()}).required();var N=e=>{var r,s,a;let{onRegistrationClick:i,onResetPasswordClick:l}=e;(0,R.useRouter)();let{setUser:d}=(0,n.useContext)(W.V),{setPasswordRecoveryData:u}=(0,n.useContext)(z),{setRegistrationData:m}=(0,n.useContext)(_),{control:h,handleSubmit:g,setError:Z,formState:y}=(0,v.cI)({defaultValues:{email:"",password:""},resolver:(0,x.X)(T)});(0,n.useEffect)(()=>{u({email:""}),m({name:"",parentName:"",birth:"",email:"",phone:"",password:""})},[]);let A=async e=>{try{let r=await C.Z.login({email:e.email,password:e.password});d(r.user)}catch(e){Z("root",{message:e.response.data.message})}};return(0,o.jsxs)(p.Z,{sx:{padding:2.5},children:[(0,o.jsxs)("form",{style:{display:"flex",flexDirection:"column"},onSubmit:g(A),children:[(0,o.jsxs)(j.Z,{spacing:1.5,children:[(0,o.jsx)(w,{control:h,name:"email",label:"Почта",fullWidth:!0}),(0,o.jsx)(w,{control:h,name:"password",label:"Пароль",type:"password",fullWidth:!0}),(null===(r=y.errors.root)||void 0===r?void 0:r.message)&&(0,o.jsx)(c.Z,{color:"error",children:Array.isArray(y.errors.root.message)?null===(s=y.errors.root)||void 0===s?void 0:s.message[0]:null===(a=y.errors.root)||void 0===a?void 0:a.message}),(0,o.jsx)(b.Z,{component:"a",underline:"none",fontSize:14,sx:{alignSelf:"flex-end",cursor:"pointer"},onClick:l,children:"Забыли пароль?"})]}),(0,o.jsx)(f.Z,{type:"submit",variant:"contained",sx:{marginTop:2},children:"Войти"})]}),(0,o.jsxs)(t.Z,{sx:{display:"flex",justifyContent:"center",gap:"5px",marginTop:.5,marginBottom:-1.5},children:[(0,o.jsx)(c.Z,{fontSize:14,children:"Нет аккаунта?"}),(0,o.jsx)(b.Z,{fontSize:14,component:"button",underline:"none",onClick:i,children:"Регистрация"})]})]})};let D=Z.Ry({email:Z.Z_().email().required()}).required();var V=e=>{var r,s,a;let{onContinueClick:i}=e,{setPasswordRecoveryData:l}=(0,n.useContext)(z),{control:t,handleSubmit:d,setError:u,formState:m}=(0,v.cI)({defaultValues:{email:""},resolver:(0,x.X)(D)}),h=async e=>{l(e);try{await C.Z.sendCode(e.email),i()}catch(e){u("root",{message:e.response.data.message})}};return(0,o.jsx)(p.Z,{sx:{padding:2.5},children:(0,o.jsxs)("form",{style:{display:"flex",flexDirection:"column"},onSubmit:d(h),children:[(0,o.jsxs)(j.Z,{spacing:1.5,children:[(0,o.jsx)(w,{control:t,name:"email",label:"Почта",fullWidth:!0}),(null===(r=m.errors.root)||void 0===r?void 0:r.message)&&(0,o.jsx)(c.Z,{color:"error",children:Array.isArray(m.errors.root.message)?null===(s=m.errors.root)||void 0===s?void 0:s.message[0]:null===(a=m.errors.root)||void 0===a?void 0:a.message})]}),(0,o.jsx)(f.Z,{type:"submit",variant:"contained",sx:{marginTop:2},children:"Продолжить"})]})})};let E=Z.Ry({code:Z.Z_().min(4).max(4).matches(/^\d\d\d\d$/).required()}).required();var X=e=>{var r,s,a;let{onContinueClick:i}=e,{setUser:l}=(0,n.useContext)(W.V),{registrationData:t}=(0,n.useContext)(_),{passwordRecoveryData:d}=(0,n.useContext)(z),{control:u,handleSubmit:m,setError:h,formState:g}=(0,v.cI)({defaultValues:{code:""},resolver:(0,x.X)(E)}),Z=async e=>{console.log(d);try{if(await C.Z.validateCode({email:d.email||t.email,code:Number(e.code)}),t.parentName){let e=await C.Z.register(t);l(e.user)}else if(t.email){let e=await C.Z.registerCoach(t);l(e.user)}i()}catch(e){h("root",{message:e.response.data.message})}};return(0,o.jsx)(p.Z,{sx:{padding:2.5},children:(0,o.jsxs)("form",{style:{display:"flex",flexDirection:"column"},onSubmit:m(Z),children:[(0,o.jsxs)(j.Z,{spacing:1.5,children:[(0,o.jsx)(w,{control:u,name:"code",label:"Код",fullWidth:!0}),(null===(r=g.errors.root)||void 0===r?void 0:r.message)&&(0,o.jsx)(c.Z,{color:"error",children:Array.isArray(g.errors.root.message)?null===(s=g.errors.root)||void 0===s?void 0:s.message[0]:null===(a=g.errors.root)||void 0===a?void 0:a.message})]}),(0,o.jsx)(f.Z,{type:"submit",variant:"contained",sx:{marginTop:2},children:"Продолжить"})]})})};let I=Z.Ry({password:Z.Z_().min(8).required(),passwordAgain:Z.Z_().min(8).required()}).required();var B=e=>{let{onContinueClick:r}=e,{passwordRecoveryData:s}=(0,n.useContext)(z),{control:a,handleSubmit:i,setError:l}=(0,v.cI)({defaultValues:{password:"",passwordAgain:""},resolver:(0,x.X)(I)}),t=async e=>{if(e.password!==e.passwordAgain){l("password",{type:"value",message:"Пароли не совпадают"}),l("passwordAgain",{type:"value",message:"Пароли не совпадают"});return}try{await C.Z.recoverPassword({email:s.email,password:e.password}),r()}catch(e){l("root",{message:e.response.data.message})}};return(0,o.jsx)(p.Z,{sx:{padding:2.5},children:(0,o.jsxs)("form",{style:{display:"flex",flexDirection:"column"},onSubmit:i(t),children:[(0,o.jsxs)(j.Z,{spacing:1.5,children:[(0,o.jsx)(w,{control:a,name:"password",label:"Пароль",type:"password",fullWidth:!0}),(0,o.jsx)(w,{control:a,name:"passwordAgain",label:"Повторите пароль",type:"password",fullWidth:!0})]}),(0,o.jsx)(f.Z,{type:"submit",variant:"contained",sx:{marginTop:2},children:"Сменить пароль"})]})})},F=s(9703);let L=e=>{let{}=e,r=(0,R.useRouter)(),[s,a]=(0,n.useState)(0),[i,l]=(0,n.useState)({}),[u,x]=(0,n.useState)({}),{user:p,isLoading:h}=(0,F.j)({routeToPushIfAuth:"/account"});return h||p?null:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(m(),{children:[(0,o.jsx)("title",{children:"Авторизация"}),(0,o.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,o.jsx)("meta",{name:"format-detection",content:"telephone=no"}),(0,o.jsx)("link",{rel:"icon",href:"/footykids-icon.png"})]}),(0,o.jsx)(t.Z,{sx:{height:"100%"},children:(0,o.jsx)(d.Z,{maxWidth:"largePhone",sx:{height:"100%"},children:(0,o.jsx)(t.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",gap:"20px",padding:"40px 0"},children:[...[[(0,o.jsx)(c.Z,{fontSize:{smallPhone:26,middlePhone:30},children:"Вход или регистрация"},0),(0,o.jsx)(N,{onRegistrationClick:()=>a(1),onResetPasswordClick:()=>a(2)},1)],[(0,o.jsxs)(_.Provider,{value:{registrationData:u,setRegistrationData:x},children:[(0,o.jsx)(c.Z,{fontSize:30,children:"Регистрация"}),(0,o.jsx)(P,{onLoginClick:()=>a(0),onRegistrationClick:()=>a(5)})]},2)],[(0,o.jsxs)(z.Provider,{value:{passwordRecoveryData:i,setPasswordRecoveryData:l},children:[(0,o.jsx)(c.Z,{fontSize:{smallPhone:24,middlePhone:30},children:"Восстановление пароля"}),(0,o.jsx)(V,{onContinueClick:()=>a(3)})]},3)],[(0,o.jsxs)(z.Provider,{value:{passwordRecoveryData:i,setPasswordRecoveryData:l},children:[(0,o.jsx)(c.Z,{fontSize:{smallPhone:24,middlePhone:30},children:"Восстановление пароля"}),(0,o.jsx)(c.Z,{fontSize:14,children:"Мы выслали код Вам на почту, введите его в поле ниже, чтобы продолжить"}),(0,o.jsx)(X,{onContinueClick:()=>a(4)})]},4)],[(0,o.jsxs)(z.Provider,{value:{passwordRecoveryData:i,setPasswordRecoveryData:l},children:[(0,o.jsx)(c.Z,{fontSize:{smallPhone:24,middlePhone:30},children:"Восстановление пароля"}),(0,o.jsx)(B,{onContinueClick:()=>a(0)})]},5)],[(0,o.jsxs)(_.Provider,{value:{registrationData:u,setRegistrationData:x},children:[(0,o.jsx)(c.Z,{fontSize:30,children:"Регистрация"}),(0,o.jsx)(c.Z,{fontSize:14,children:"Мы выслали код Вам на почту, введите его в поле ниже, чтобы продолжить"}),(0,o.jsx)(X,{onContinueClick:()=>r.push("/account")})]},6)]][s]]})})})]})};L.getLayout=e=>(0,o.jsx)(a.Z,{renderHeader:()=>(0,o.jsx)(i.Z,{}),renderFooter:()=>(0,o.jsx)(l.Z,{}),children:(0,o.jsx)(t.Z,{sx:{height:"100%"},children:e})});var O=L}},function(e){e.O(0,[35,876,510,528,774,888,179],function(){return e(e.s=2304)}),_N_E=e.O()}]);